import subprocess
import sys

"""
Recherche d'informations sur un nom de domaine ou une adresse IP en utilisant les 3 meilleur moteurs de recherche.
"""


def search_information(domain_or_ip):
    INFORMATION_TYPES = ['email', 'subdomains']
    SEARCH_ENGINES = ['google', 'bing', 'yahoo']
    results = []
    try:
        import theHarvester
    except ImportError:
        print("Harvester isn't installed.Try to install it ....")
        subprocess.run(['pip', 'install', 'theHarvester'])
    for search_engine in SEARCH_ENGINES:
        for information_type in INFORMATION_TYPES:
            command = "theHarvester -d {} -b {} -e {}".format(domain_or_ip, search_engine, information_type)
            output = subprocess.run(command, capture_output=True).stdout.decode()
            print(output)
            results.append((search_engine, information_type, output))
        html = format_results(results, f"Résultats de la recherche sur {domain_or_ip}")
        print(html)


"""
    Formate les résultats de la recherche en page HTML.
"""


def format_results(results, title):
    html = "<html><head><title>{title}</title></head><body>"
    html += "<h1>{title}</h1>"
    html += "<table>"
    for search_engine, information_type, output in results:
        html += f"<tr><th>{search_engine} ({information_type})</th></tr>"
        html += f"<tr><td>{output}</td></tr>"
    html += "</table>"
    html += "</body></html>"
    return html
